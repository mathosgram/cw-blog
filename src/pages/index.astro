---
import { getCollection } from "astro:content";
import Layout from "@/layouts/Layout.astro";
import Header from "@/components/Header.astro";
import Footer from "@/components/Footer.astro";
import LinkButton from "@/components/LinkButton.astro";
import Card from "@/components/Card.astro";
import Hr from "@/components/Hr.astro";
import getSortedPosts from "@/utils/getSortedPosts";
import IconRss from "@/assets/icons/IconRss.svg";
import IconArrowRight from "@/assets/icons/IconArrowRight.svg";

// Get static posts from content collection
const posts = await getCollection("blog");
const sortedPosts = getSortedPosts(posts);
const featuredPosts = sortedPosts.filter(({ data }) => data.featured);
const recentPosts = sortedPosts.filter(({ data }) => !data.featured);
---

<Layout>
  <Header />
  <main id="main-content">
    <section id="hero">
      <h1 class="mr-2 text-4xl font-bold">
        Welcome to <span style="color: var(--color-accent);">Stack</span>
      </h1>
      <a
        target="_blank"
        href="/rss.xml"
        class="rss-link"
        aria-label="rss feed"
        title="RSS Feed"
      >
        <IconRss class="inline-block size-6 fill-current" />
      </a>

      <p>
        Stack is the official writing platform for the Cowrywise Ambassador Writing Group. 
        Here, our ambassadors share insights on personal finance, investment strategies, 
        and financial literacy to help Nigerians build wealth and achieve financial freedom.
      </p>
      <p class="mt-2">
        Join our community of financial writers and discover stories that inspire smart money decisions.
        Together, we're building a financially literate Nigeria, one story at a time.
      </p>

    </section>

    <Hr />

    <!-- Featured Posts -->
    {
      featuredPosts.length > 0 && (
        <>
          <section id="featured" class="pt-12 pb-6">
            <h2 class="text-2xl font-semibold tracking-wide">Featured</h2>
            <ul>
              {featuredPosts.map(data => (
                <Card variant="h3" {...data} />
              ))}
            </ul>
          </section>
          {recentPosts.length > 0 && <Hr />}
        </>
      )
    }

    <!-- Recent Posts -->
    {
      recentPosts.length > 0 && (
        <section id="recent-posts" class="pb-6 pt-12">
          <h2 class="text-2xl font-semibold tracking-wide">Recent Posts</h2>
          <ul>
            {recentPosts.map(data => (
              <Card variant="h3" {...data} />
            ))}
          </ul>
        </section>
      )
    }

    <div class="all-posts-btn-wrapper">
      <LinkButton href="/posts/">
        All Posts
        <IconArrowRight class="inline-block size-4 fill-current" />
      </LinkButton>
    </div>
  </main>

  <Footer />
</Layout>

<style>
  #hero {
    padding-bottom: 1.5rem;
    padding-top: 2rem;
  }
  #hero h1 {
    margin: 1rem 0;
    display: inline-block;
    font-size: 1.875rem;
    font-weight: 700;
  }
  @media (min-width: 640px) {
    #hero h1 {
      margin: 2rem 0;
      font-size: 3rem;
    }
  }
  #hero .rss-link {
    margin-bottom: 1.5rem;
  }
  #hero .rss-link svg {
    margin-bottom: 0.5rem;
    display: inline-block;
    width: 1.5rem;
    height: 1.5rem;
    transform: scale(1.1);
    fill: color-mix(in srgb, var(--color-accent) 75%, transparent);
    transition: all 0.3s;
  }
  #hero .rss-link svg:hover {
    fill: var(--color-accent);
  }
  @media (min-width: 640px) {
    #hero .rss-link svg {
      margin-bottom: 0.75rem;
      transform: scale(1.25);
    }
  }
  #hero p {
    margin: 0.5rem 0;
  }
  #featured,
  #recent-posts {
    padding-bottom: 1.5rem;
    padding-top: 3rem;
  }
  #featured h2,
  #recent-posts h2 {
    font-size: 1.5rem;
    font-weight: 600;
    letter-spacing: 0.025em;
  }
  .all-posts-btn-wrapper {
    margin: 2rem 0;
    text-align: center;
  }
</style>
